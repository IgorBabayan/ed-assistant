<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:dto="clr-namespace:EdAssistant.DTO"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:CompileBindings="False"
             x:Class="EdAssistant.Views.Pages.HomeView">
    <UserControl.Styles>
        <Style Selector="Border.rank-card">
            <Setter Property="Background" Value="{DynamicResource Bg.Brush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Border.Brush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="MinWidth" Value="280"/>
            <Setter Property="MinHeight" Value="120"/>
            <Setter Property="MaxWidth" Value="400"/>
            <Setter Property="BoxShadow" Value="0 2 8 0 #1A000000"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2"/>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Border.rank-card:pointerover">
            <Setter Property="RenderTransform" Value="scale(1.02)"/>
            <Setter Property="BoxShadow" Value="0 4 16 0 #2A000000"/>
        </Style>

        <Style Selector="TextBlock.rank-title">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource Text.Primary}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="MaxLines" Value="2"/>
        </Style>

        <Style Selector="TextBlock.rank-subtitle">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{DynamicResource Text.Secondary}"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="MaxLines" Value="2"/>
        </Style>

        <Style Selector="ProgressBar.rank-progress">
            <Setter Property="Height" Value="6"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="Background" Value="#2A2D35"/>
            <Setter Property="Foreground" Value="{DynamicResource Accent.Brush}"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Name="PART_Track"
                            Background="{TemplateBinding Background}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Height="{TemplateBinding Height}">
                        <Border Name="PART_Indicator"
                                Background="{TemplateBinding Foreground}"
                                HorizontalAlignment="Left"
                                CornerRadius="{TemplateBinding CornerRadius}"/>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>

        <Style Selector="TextBlock.progress-text">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{DynamicResource Text.Secondary}"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="Opacity" Value="0.7"/>
        </Style>

        <Style Selector="ItemsControl.responsive-grid">
            <Setter Property="ItemsPanel">
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </Setter>
        </Style>

        <Style Selector="Border.rank-card.compact">
            <Setter Property="MinWidth" Value="200"/>
            <Setter Property="MaxWidth" Value="300"/>
            <Setter Property="Padding" Value="12"/>
        </Style>

        <Style Selector="Border.rank-card.compact Image">
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
        </Style>

        <Style Selector="Border.rank-card.compact TextBlock.rank-title">
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style Selector="Border.rank-card.compact TextBlock.rank-subtitle">
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!--// Loading Screen Styles //-->
        <Style Selector="Border.loading-overlay">
            <Setter Property="Background" Value="{DynamicResource Bg.Brush}"/>
            <Setter Property="Opacity" Value="0.98"/>
        </Style>

        <Style Selector="Border.loading-container">
            <Setter Property="Background" Value="{DynamicResource Bg.Brush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Border.Brush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="40"/>
            <Setter Property="BoxShadow" Value="0 8 32 0 #30000000"/>
        </Style>

        <Style Selector="TextBlock.loading-text">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{DynamicResource Text.Primary}"/>
            <Setter Property="Margin" Value="0,16,0,0"/>
        </Style>

        <!--// Loading Spinner Animation //-->
        <Style Selector="Ellipse#LoadingSpinner">
            <Style.Animations>
                <Animation Duration="0:0:1.5" IterationCount="Infinite">
                    <KeyFrame Cue="0%">
                        <Setter Property="(RotateTransform.Angle)" Value="0"/>
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="(RotateTransform.Angle)" Value="360"/>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!--// Main Content //-->
        <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      Margin="{DynamicResource Space.4}">
            <StackPanel Spacing="24" MaxWidth="1400">
                <!--// Header section //-->
                <StackPanel Spacing="8">
                    <TextBlock Text="Progress Overview"
                               FontSize="28"
                               FontWeight="Bold"
                               Foreground="{DynamicResource Text.Primary}"/>
                    <TextBlock Text="Elite Dangerous Commander Progression"
                               FontSize="14"
                               Foreground="{DynamicResource Text.Secondary}"
                               Opacity="0.7"/>
                </StackPanel>

                <!--// Responsive rank cards using ItemsControl with WrapPanel //-->
                <ItemsControl ItemsSource="{Binding Ranks}"
                              Classes="responsive-grid">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="dto:RankDTO">
                            <Border Classes="rank-card"
                                    Margin="8">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!--// Rank Icon //-->
                                    <Image Grid.Row="0"
                                           Grid.Column="0"
                                           Grid.RowSpan="2"
                                           Width="64"
                                           Height="64"
                                           Margin="0,0,16,0"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           Source="{Binding Rank, Converter={StaticResource RankToIconConverter}}"/>

                                    <!--// Rank Info //-->
                                    <StackPanel Grid.Row="0"
                                                Grid.Column="1"
                                                Spacing="4"
                                                VerticalAlignment="Top">
                                        <TextBlock Classes="rank-title"
                                                   Text="{Binding Rank, Converter={StaticResource EnumLocalizationConverter}}"/>
                                        <TextBlock Classes="rank-subtitle"
                                                   Text="{Binding Title}"/>
                                    </StackPanel>

                                    <!--// Progress Section //-->
                                    <StackPanel Grid.Row="1"
                                                Grid.Column="1"
                                                Spacing="6"
                                                VerticalAlignment="Bottom"
                                                Margin="0,12,0,0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                       Text="Progress"
                                                       FontSize="11"
                                                       FontWeight="Medium"
                                                       Foreground="{DynamicResource Text.Secondary}"
                                                       Opacity="0.6"/>
                                            <TextBlock Grid.Column="1"
                                                       Classes="progress-text"
                                                       Text="{Binding Progress, StringFormat='{}{0}%'}"/>
                                        </Grid>
                                        <ProgressBar Classes="rank-progress"
                                                     Value="{Binding Progress}"
                                                     Maximum="100"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!--// Fallback: Vertical layout for very narrow screens //-->
                <StackPanel Name="MobileLayout"
                            IsVisible="False"
                            Spacing="12">
                    <ItemsControl ItemsSource="{Binding Ranks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="dto:RankDTO">
                                <Border Classes="rank-card compact"
                                        Margin="0,0,0,8"
                                        MinWidth="0"
                                        MaxWidth="{Binding $parent[ScrollViewer].Bounds.Width}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!--// Compact Icon //-->
                                        <Image Grid.Column="0"
                                               Width="48"
                                               Height="48"
                                               Margin="0,0,12,0"
                                               VerticalAlignment="Center"
                                               Source="{Binding Rank, Converter={StaticResource RankToIconConverter}}"/>

                                        <!--// Compact Info //-->
                                        <StackPanel Grid.Column="1"
                                                    Spacing="8"
                                                    VerticalAlignment="Center">
                                            <StackPanel Spacing="2">
                                                <TextBlock Classes="rank-title"
                                                           FontSize="14"
                                                           Text="{Binding Rank, Converter={StaticResource EnumLocalizationConverter}}"/>
                                                <TextBlock Classes="rank-subtitle"
                                                           FontSize="12"
                                                           Text="{Binding Title}"/>
                                            </StackPanel>

                                            <StackPanel Spacing="4">
                                                <Grid>
                                                    <TextBlock Text="Progress"
                                                               FontSize="10"
                                                               Foreground="{DynamicResource Text.Secondary}"/>
                                                    <TextBlock Text="{Binding Progress, StringFormat='{}{0}%'}"
                                                               FontSize="10"
                                                               HorizontalAlignment="Right"
                                                               Foreground="{DynamicResource Text.Secondary}"/>
                                                </Grid>
                                                <ProgressBar Classes="rank-progress"
                                                             Height="4"
                                                             Value="{Binding Progress}"
                                                             Maximum="100"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>